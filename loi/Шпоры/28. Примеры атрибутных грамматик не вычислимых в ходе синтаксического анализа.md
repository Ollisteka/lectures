### Примеры более сложных атрибутных грамматик

#### Первый

| $S \rightarrow L$       | $L.i = 0$       |
| ----------------------- | --------------- |
| $L \rightarrow L_11$    | $L_1.i = L.i+1$ |
| $L \rightarrow \lambda$ | $PRINT(L.i)$    |

Эта грамматику нельзя транслировать в ходе LR-анализа, потому что первая свёртка произойдёт по правилу $L \rightarrow \lambda$ и нам сразу же надо будет напечатать атрибут $L.i$ — количество единиц в строке. Но в этот момент мы ещё ничего про них не знаем!

Можно превратить эту грамматику в *S-атрибутную*:

| $S \rightarrow L$       | $PRINT(L.s)$    |
| ----------------------- | --------------- |
| $L \rightarrow 1L_1$    | $L.s = L_1.s+1$ |
| $L \rightarrow \lambda$ | $L.s = 0$       |

А можно оставить L-атрибутную грамматику, но ввести маркеры:

| $S \rightarrow ML$      | $L.i = M.s$                 |
| ----------------------- | --------------------------- |
| $L \rightarrow 1NL_1$   | $N.i = L.i+1,\\L_1.i = N.s$ |
| $L \rightarrow \lambda$ | $PRINT(L.i)$                |
| $M \rightarrow \lambda$ | $M.s = 0$                   |
| $N \rightarrow \lambda$ | $N.s = N.i$                 |

Теперь можно использовать восходящий транслятор!

#### Второй

| $S \rightarrow L_1L_2$ | $S.s = f_1(L_1.s, L_2.s) \\ L_1.i = g_1(S.i)\\L_2.i = h_1(S.i, L_1.i)$ |
| ---------------------- | ------------------------------------------------------------ |
| $S \rightarrow R_1R_2$ | $S.s = f_2(R_1.s, R_2.s) \\ R_1.i = g_2(R_2.s)\\R_2.i = h_2(S.i)$ |

За один проход транслировать эту грамматику не получится! И вообще это не L-атрибутная грамматика, потому что во втором правиле $R_1$ зависит от атрибутов правого брата $R_2$

Сначала надо построить дерево вывода, потом вычислить атрибуты, при этом:

- в правилах $S \rightarrow L_1L_2$ сыновей обходить слева направо 
- в правилах $S \rightarrow R_1R_2$ сыновей обходить справа налево



#### Третий

| $S \rightarrow E$      | $E_i = h_1(E.s)\\S.t = E.t$                                  |
| ---------------------- | ------------------------------------------------------------ |
| $E \rightarrow E_1E_2$ | $E.s = f_1(E_1.s, E_2.s)\\E_1.s = g_1(E.i)\\E_2.i=g_2(E.i)\\E.t = h_2(E_1.t, E_2.t)$ |
| $E \rightarrow x$      | $E.s = x.s\\E.t = E.i$                                       |



Синтезируемые атрибуты:

- $.s$ — зависит от одноимённых атрибутов сыновей
- $.t$ — зависит от одноимённых атрибутов сыновей или, если сын — лист, от атрибута $.i$ самого узла

Наследуемые атрибуты:

- $.i$ — зависит от одноимённого атрибута родителя или, если родитель — аксиома, от атрибута $.s$ самого узла

```
Зависимости:
			s → сыновья
			↑
 родители ← i 
			↑
			t → сыновья
```

Следовательно, для вычисления всех атрибутов нужно:

1. пройти по дереву вывода *снизу вверх*, вычисляя атрибут $.s$;

2. пройти по дереву вывода *сверху вниз*, вычисляя атрибут $.i$;

3. ещё раз пройти *снизу вверх*, вычисляя атрибут $.t$.

На практике можно транслировать данную атрибутную грамматику в два прохода. Сначала провести синтаксический анализ *снизу вверх* с построением дерева и вычислением значений атрибута $.s$ во всех узлах, а затем по дереву рекурсивно вычислить значения атрибутов $.i$ и $.t$ (требуется один стандартный обход дерева в глубину).