### Орг. вопросы

- компы - универские;
- винда - 32 бита;

##### Как получать баллы

- домашки на неделю;
- задачи на практике;
- финальная задача.

##### Как сдавать задачи
- понимать, что происходит в коде.

##### С чем будем работать
- OS;
- BIOS;
- напрямую с устройствами I\O.

##### Как
- порты;
- выделенные системные структуры памяти.

###Программы-резиденты (TSR Terminate and State Residents)
**Программа-резидент** — висит в ОП, может быть вызвана каким-то определённым образом. 

> Все программы пишем для x86 в режиме реальной адресации под DOS.

Как обратиться к резидентной программе?

- через определённое прерывание

Написать резидента == написать блок, реализующий функционал + установщик. 

В итоговом COM файле первой командой будет JMP на начало установщика.

Программа:

```
model tiny 		;все сегменты кода, данных и стека являются одним сегментом

.code
ORG 100h 		;отсюда начинаются адреса нашей программы. До этого лежит PSP?
```

ORG: до этого адреса лежит PSP (program segment prefix - Префикс программного сегмента)

> Чем отличается .com от .exe?

>  Что такое и зачем нужен PSP?

При загрузке com файла DOS создаёт 3 вспомогательные структуры: машинный код (бинарник), PSP и DOS-environment

> Что такое и зачем нужен DOS-environment?
>
> Подсказка: в этом блоке памяти в формате плоского файла хранится информация о переменных окружения.

Что от нас ждут:

- находить в памяти эти блоки;
- обосновывать, что они относятся именно к нашей программе.

Что использовать?

- debug
- [symdeb](http://koapp.narod.ru/tehlit/programmer/assembler/masm/a1p4.html)
- turbo debugger (td)
- peporez (тройной альт?)



**!**`tasm /m` – **m**ultiple passes - оптимизация прыжков. Бывают близкие, адрес занимает 2 байта, и дальние, на 3. Если пробежать программу несколько раз, то можно понять, где какие. А иначе по дефолту все прыжки будут длинными.



##### ДЗ №1

> Написать программу, которая может загрузить резидента одним из двух способов (параметр командной строки):
>
> - 31h (INT 21 -> 31) функция DOS
>
> - INT 27h
>
> Чем отличаются эти способы? Вызовам нужны разные аргументы.
>
> Как будет выглядеть готовый файл:
>
> - Блок резидента: hello.asm
> - Блок инсталляции: смотрим на то, что пришло из командной строки



Как посмотреть резидентов:

- mem
- F2



> Разобраться, как работает 25, 35, 49 функция DOS
>
> Потом посмотреть на ОП и найти свою программу